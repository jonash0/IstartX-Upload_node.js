<!-- views/upload.ejs - Upload form template for base44.com -->
<div class="upload-container">
    <div class="page-header">
        <h1><i class="fas fa-cloud-upload-alt"></i> File Upload</h1>
        <p class="text-muted">Upload files to B2 storage for user: <strong><%= user.id %></strong></p>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Upload Files</h5>
                </div>
                <div class="card-body">
                    <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
                        <div class="form-group mb-3">
                            <label for="user_id" class="form-label">User ID</label>
                            <input type="text" class="form-control" id="user_id" name="user_id" 
                                   value="<%= user.id %>" required>
                        </div>

                        <div class="form-group mb-3">
                            <label for="files" class="form-label">Select Files</label>
                            <input type="file" class="form-control" id="files" name="files" 
                                   multiple accept="*/*">
                            <div class="form-text">
                                Hold Ctrl (Windows) or Cmd (Mac) to select multiple files
                            </div>
                        </div>

                        <div id="fileList" class="file-preview mb-3" style="display: none;">
                            <h6>Selected Files:</h6>
                            <div id="fileItems"></div>
                        </div>

                        <button type="submit" id="uploadBtn" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Upload Files
                        </button>
                    </form>

                    <div id="uploadProgress" class="progress mt-3" style="display: none;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 100%">
                            Uploading...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">Upload Statistics</h6>
                </div>
                <div class="card-body">
                    <div class="stat-item mb-2">
                        <span class="stat-label">Files Selected:</span>
                        <span id="fileCount" class="badge bg-primary">0</span>
                    </div>
                    <div class="stat-item mb-2">
                        <span class="stat-label">Total Size:</span>
                        <span id="totalSize" class="badge bg-info">0 KB</span>
                    </div>
                    <div class="stat-item mb-2">
                        <span class="stat-label">Storage:</span>
                        <span class="badge bg-success">Backblaze B2</span>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">Quick Actions</h6>
                </div>
                <div class="card-body">
                    <button class="btn btn-outline-secondary btn-sm mb-2 w-100" onclick="clearFiles()">
                        <i class="fas fa-times"></i> Clear Selection
                    </button>
                    <button class="btn btn-outline-info btn-sm w-100" onclick="showApiExample()">
                        <i class="fas fa-code"></i> API Example
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.upload-container {
    padding: 20px;
}

.file-preview {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 15px;
}

.file-item {
    display: flex;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #e9ecef;
}

.file-item:last-child {
    border-bottom: none;
}

.file-icon {
    width: 24px;
    height: 24px;
    background: #0d6efd;
    color: white;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    margin-right: 10px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.stat-label {
    font-size: 0.9em;
    color: #6c757d;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('files');
    const fileList = document.getElementById('fileList');
    const fileItems = document.getElementById('fileItems');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadForm = document.getElementById('uploadForm');
    const uploadProgress = document.getElementById('uploadProgress');
    const fileCount = document.getElementById('fileCount');
    const totalSize = document.getElementById('totalSize');

    fileInput.addEventListener('change', function() {
        const files = this.files;
        
        if (files.length > 0) {
            let totalBytes = 0;
            
            fileList.style.display = 'block';
            fileItems.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                totalBytes += file.size;
                const fileExt = file.name.split('.').pop().toUpperCase();
                
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-icon">${fileExt.charAt(0)}</div>
                    <div class="flex-grow-1">
                        <div class="fw-bold">${file.name}</div>
                        <small class="text-muted">${(file.size / 1024).toFixed(2)} KB</small>
                    </div>
                `;
                fileItems.appendChild(fileItem);
            });
            
            fileCount.textContent = files.length;
            totalSize.textContent = (totalBytes / 1024).toFixed(2) + ' KB';
            uploadBtn.innerHTML = `<i class="fas fa-upload"></i> Upload ${files.length} File${files.length > 1 ? 's' : ''}`;
        } else {
            fileList.style.display = 'none';
            fileCount.textContent = '0';
            totalSize.textContent = '0 KB';
            uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Files';
        }
    });

    uploadForm.addEventListener('submit', function() {
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        uploadProgress.style.display = 'block';
    });
});

function clearFiles() {
    document.getElementById('files').value = '';
    document.getElementById('files').dispatchEvent(new Event('change'));
}

function showApiExample() {
    const modal = `
        <div class="modal fade" id="apiModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">API Usage Example</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <h6>JavaScript/AJAX Upload:</h6>
                        <pre><code>const formData = new FormData();
formData.append('user_id', 'your-user-id');
formData.append('files', fileInput.files[0]);

fetch('/upload', {
    method: 'POST',
    body: formData,
    headers: {
        'Accept': 'application/json'
    }
})
.then(response => response.json())
.then(data => console.log(data));</code></pre>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modal);
    new bootstrap.Modal(document.getElementById('apiModal')).show();
}
</script>